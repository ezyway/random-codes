import os
import sys
import json
import shutil

os.system('clear')

script_path = os.path.dirname(os.path.realpath(sys.argv[0]))
json_location = script_path + "/json"

# Get all files in the JSON dir
files = os.listdir(json_location)

for i in files:
    with open(json_location + "/" + i, 'r') as jfile:
        jfile_data = jfile.read()
        jfile_data = jfile_data.split("\n",1)
        jfile_dict = json.loads(jfile_data[1])

        # Get all file related data [hash, type, first-seen]
        hash = jfile_dict['data'][0]['sha256_hash']
        file_type = jfile_dict['data'][0]['file_type']
        first_seen = jfile_dict['data'][0]['first_seen'][:4]
        file_name = hash + "." + file_type

        # Check if the dirs are made, else make it
        copy_location = script_path + "/Sorted/" + first_seen + "/" + file_type
        if not os.path.exists(copy_location):
            os.makedirs(copy_location)

        # Copy the file to the location. shutil.copy2 will preserve initial file creation data [mod_date, created_date, etc...]
        init_file_location = script_path + "/Test1/" + hash + "." + file_type
        final_file_location = script_path + "/Sorted/" + first_seen + "/" + file_type + "/" + hash + "." + file_type
        shutil.copy2(init_file_location, final_file_location)

    
    
print('exec completed')